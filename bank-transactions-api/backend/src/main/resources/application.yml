management:
  health:
    livenessstate.enabled: true
    readinessstate.enabled: true

  security.enabled: false

  server.port: 3001

  tracing.sampling.probability: 1.0

  endpoints:
    web.exposure.include: '*'
    jmx.exposure.include: '*'

    shutdown:
      enabled: true
      access: UNRESTRICTED

    loggers.access: UNRESTRICTED

    health:
      enabled: true
      show-details: ALWAYS

    probes.enabled: true

    cors:
      allowed-origins: '*'
      enabled-by-default: false

    default.access: UNRESTRICTED

server:
  port: 2024
  shutdown: GRACEFUL
  http2.enabled: true

  tomcat:
    connection-timeout: 20m
    keep-alive-timeout: 20m
    max-http-form-post-size: 50MB
    max-swallow-size: 50MB
    max-keep-alive-requests: 3000

  servlet.session.timeout: 10m

  compression:
    enabled: true
    mime-types: >
      text/html,text/xml,text/plain,text/css,text/javascript,
      application/javascript,application/json
    min-response-size: 1024

spring:
  application.name: ${MICROSERVICE:backend}

  profiles.active: ${ENV:dev}

  main:
    allow-circular-references: false
    lazy-initialization: false

  thread.virtual.enabled: true

  cloud:
    discovery:
      service-id: ${MICROSERVICE:backend}
      enabled: true

  datasource:
    url: ${POSTGRES_URI}
    username: ${POSTGRES_USER}
    password: ${POSTGRES_PASSWORD}
    driver-class-name: org.postgresql.Driver

    hikari:
      pool-name: ${MICROSERVICE:backend}
      maximum-pool-size: 50
      minimum-idle: 10
      connection-timeout: 10000
      idle-timeout: 600000
      max-lifetime: 1800000
      validation-timeout: 5000
      connection-test-query: SELECT 1   # FIXED
      leak-detection-threshold: 0       # OK but usually not needed

  jpa:
    show-sql: false
    database: POSTGRESQL

    hibernate:
      ddl-auto: update
      naming-strategy: org.hibernate.cfg.ImprovedNamingStrategy
      # dialect removed â€” Hibernate auto-selects it

      query:
        plan-cache-max-size: 16000
        plan-parameter-metadata-max-size: 16000

    properties:
      hibernate:
        jdbc.batch_size: 100
        order_inserts: true
        order_updates: true
        generate_statistics: false
        cache.use_second_level_cache: true
        temp.use_jdbc_metadata_defaults: false

    sql.init.platform: POSTGRESQL

  jackson.serialization.write_dates_as_timestamps: false

caffeine:
  default:
    expiration-time-millis: 90000
    allow-null-values: false
    maximum-cache-size: 900000

logging:
  structured:
    format.console: ecs
    format.file: ecs

    json.add:
      host: ${MICROSERVICE:backend}
      version: 1.0

    ecs.service:
      name: ${MICROSERVICE:backend}
      version: 1.0
      environment: ${ENV}
      node-name: primary

  pattern.level: '%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]'

  level:
    root: INFO
    io.project: INFO
